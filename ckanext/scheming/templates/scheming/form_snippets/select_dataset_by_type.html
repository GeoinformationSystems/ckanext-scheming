{% import 'macros/form.html' as form %}


{% with
	name=field.field_name,
	id='field-' + field.field_name,
	label=h.scheming_language_text(field.label),
	placeholder=h.scheming_language_text(field.form_placeholder),
	value=data[field.field_name],
	error=errors[field.field_name],
	classes=field.classes if 'classes' in field else ['control-medium'],
	attrs=dict( **(field.get('form_attrs', {}))),
	is_required=h.scheming_field_required(field),
	required_type = 'type:' + field.required_type if 'required_type' in field else 'type:dataset'
%}


	{% call form.input_block(name,
		label=label,
		error=error,
		is_required=is_required,
		classes=classes
		) %}
		<div {{ form.attributes(field.form_attrs) if 'form_attrs' in field else '' }}>
		<select id="{{ id }}" name="{{ name }}" {{ form.attributes(attrs) }} data-module="autocomplete">
		  {% if not is_required %}
			<option value=""></option>
		  {% endif %}
		  {% set datasets_available = h.datasets_available(required_type) %}
			{% for dataset in datasets_available %}
				{% set selected_ds = data[field.field_name] %}
				<option value="{{ dataset.name }}" 
					{% if dataset.name == value %} 
						selected="selected"
					{% endif %}
				>{{ dataset.title }}</option>
			{% endfor %}
		</select>
		
		{%- snippet 'scheming/form_snippets/help_text.html', field=field %}
		</div>
	{% endcall %}
{% endwith %}



